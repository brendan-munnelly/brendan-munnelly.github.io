<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>
      The Fetch API and JSON | Full-stack Development Tutorials | Brendan Munnelly
    </title>
    <meta
      name="description"
      content="Learn how to create JSON files, use the Fetch API to retrieve them, and add error-checking to your code."
    />
    <meta name="author" content="Brendan Munnelly">

    <link rel="apple-touch-icon" sizes="180x180" href="../../assets/img/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../assets/img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../assets/img/favicon/favicon-16x16.png">
    <link rel="manifest" href="../../assets/img/favicon/site.webmanifest">

    <link rel="stylesheet" href="../../assets/css/dorset-js.css" />

	<style>
		pre { background-color: #282c34;}
        .table-js-methods td:nth-child(1) { min-width: 20%; }
	</style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark-reasonable.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>

	<script defer src="../../assets/js/cookie.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
	
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-RQ1JXS4GKM"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-RQ1JXS4GKM');
    </script>
    </head>


    <body id="top">

    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KGBDMFL"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


    <header>
      <div class="wrapper">
        <div class="sidebar">
          <div></div>
        </div>

        <div class="content">
          <h1>The Fetch API and JSON</h1>
          <h2>
            Using the Promise and Response objects of the Fetch API to access files with JSON-formatted data.
          </h2>
        </div>
      </div>
    </header>

    <main>
      <aside>
				<h3>JAVASCRIPT</h3>
	
				<p><i class="fas fa-home"></i> &nbsp;<a href="../index.html">Home</a></p>

        <h3>THIS TUTORIAL</h3>
        <p><a href="#learning-goals">Learning Goals</a></p>
        <p><a href="#intro">Introduction</a></p>
        <p><a href="#json-intro">What is JSON?</a></p>
        <p class="toc-indent"><a href="#json-format">Working with JSON-format data</a></p>
        <p class="toc-indent"><a href="#sample-json-files">Creating two sample JSON files</a></p>
        <p><a href="#basic-example">A very basic Fetch API example</a></p>
        <p><a href="#cors-file-protocol">CORS and the file:// protocol</a></p>
        <p><a href="#fetch-async-api">About the Fetch API</a></p>
        <p class="toc-indent"><a href="#promise-response-objects">Working with the Promise and Response objects</a></p>
        <p class="toc-indent"><a href="#inside-response">What's inside the <code>response</code> object?</a></p>
        <p class="toc-indent"><a href="#response-variable">About the <code>response</code> variable</a></p>
         <p class="toc-indent"><a href="#parse-response">Parsing the response with <code>.json()</code></a></p>
     <p><a href="#data-output">Outputting data to the web page</a></p>

        <p><a href="#error-checking">Error-checking Fetch API requests</a></p>

      <p class="toc-indent"><a href="#http-status-errors">Checking for HTTP status errors</a></p>

    <p class="toc-indent"><a href="#try-catch-errors">Checking for errors with <code>try...catch (error)</code></a></p>

				<p><a href="#try-it">Try it yourself</a></p>

				<p><a href="#resources">More learning resources</a></p>
		  
				<p><a href="#ai-prompts">Sample AI prompts</a></p>
	
				<p><i class="fas fa-arrow-circle-up"></i> &nbsp;<a href="#top">Back to Top</a></p>
	
				<p>&nbsp;</p>
				<p>&nbsp;</p>




      </aside>

      <article>

        <section id="learning-goals">
          <h2>Learning Goals</h2>
          <p>At the end of this Tutorial, you will be able to:</p>

          <ul>
            <li>Create text files in JSON-format.</li>
            <li>Use the asynchronous Fetch API to retrieve files from a remote server.</li>
            <li>
              Understand the roles of the Promise and Response objects.
            </li>
            <li>Check for network errors with the <span class="syn-js">try...catch (error)</span> syntax.</li>
          </ul>
        </section>


        <section>
<div class="code-snippets" style="margin-bottom:32px">
            <p>For this Tutorial, in your <b>javascript/exercises</b> folder, create four new text files:<br>
<b>list-products.html</b> and <b>list-products.js</b><br>
<b>list-users.html</b> and <b>list-users.js</b></p>
         <p>For the two web page files, use the <b>Shift + !</b> shortcut to generate skeleton HTML code.</p>   
   			<p>Also in your two web pages, add links to <b>list-products.js</b> and <b>list-users.js</b> using <code>&lt;script&gt;</code> tags with the <code>defer</code> attribute.</p>
        <p>In your <b>exercises</b> folder, create a new subfolder named <b>data</b>.</p>
        <p>Inside <b>exercises/data</b> subfolder, create two new JSON files:<br>
<b>products.json</b> and <b>users.json</b></p>
  
  </section>


      <section id="intro">
        <h2>Introduction</h2>
        <p>Up until now, all data (variables, arrays, and objects) has been hard-coded inside your JavaScript <b>.js</b> files. In the real world, data lives outside the code - in files or databases on the same or different servers.</p>

        <p>To retrieve data from such sources, you need to learn about:</p>
        
        <ul>
          <li><b>JSON-format</b>: This is the typical format for working with external data.</li>
          <li><b>Fetch API</b>: Makes it possible to retrieve external data without the web page re-loading.</li>
            <li><b>Live server</b>: For security reasons, the Fetch API runs only on a webserver.</li>
          </ul>
      </section>


<section id="json-intro">
                <h2>What is JSON?</h2>

        <p>In the <a href="arrays-objects.html" target="_blank">Arrays of objects</a> tutorial, you learnt that spreadsheet-style structured data tables in rows and columns can be represented in JavaScript by an array of objects.</p>

        <img src="assets/img/fetch-json/data-table.png" alt="screenshot">

        <ul>

                <li>Each record row is an object (with curly braces <span class="syn-js">{}</span>).</li>
                
                <li>Each object has the same keys (matching the spreadsheet columns).</li>

                <li>The items (objects) are separated by commas <span class="syn-js">,</span>.</li>

                    <li>The entire dataset is an array (with square brackets <span class="syn-js">[]</span>).</li>

        </ul>
                
        <h3 id="json-format">Working with JSON-format data</h3>

                <p><b>JSON</b> stands for <i>JavaScript Object Notation</i>. It is a common format for storing and moving data between files and web pages.</p>

            <p>JSON data looks similar to JavaScript objects but has some key differences:</p>
            <ul>
                <li>Keys (property names) must be in double quotes. For example, <b>"price"</b> and <b>"age"</b>.</li>
                <li>String values must be in double quotes. For example, <b>"laptop"</b> and <b>"Smith"</b>.</li>
                <li>No trailing commas <span class="syn-js">,</span> after the last value in objects.</li>
            </ul>

          <img src="assets/img/fetch-json/array-json.png" alt="screenshot" style="max-width:700px">

            <h3 id="sample-json-files">Creating two sample JSON files</h3>
            <p>Below are two examples of files with JSON-format data.</p>
            
            <p>Copy the data below to your <b>products.json</b> file in your <b>/data</b> subfolder.</p>

<pre><button class="copy-code" id="btn-2">Copy <i class="fa-regular fa-copy"></i></button><code id="strCode-2" class="hljs language-json">[
  { "productID": 1001, "name": "Laptop", "price": 999.99, "inStock": true },
  { "productID": 1002, "name": "Wireless Mouse", "price": 24.99, "inStock": true },
  { "productID": 1003, "name": "Mechanical Keyboard", "price": 59.99, "inStock": false },
  { "productID": 1004, "name": "HD Monitor 24-inch", "price": 149.99, "inStock": true },
  { "productID": 1005, "name": "USB-C Hub", "price": 34.99, "inStock": true },
  { "productID": 1006, "name": "External Hard Drive 1TB", "price": 79.99, "inStock": true },
  { "productID": 1007, "name": "Noise Cancelling Headphones", "price": 199.99, "inStock": false },
  { "productID": 1008, "name": "Webcam 1080p", "price": 49.99, "inStock": true },
  { "productID": 1009, "name": "HDMI Cable 2m", "price": 12.50, "inStock": true },
  { "productID": 1010, "name": "Graphics Tablet", "price": 129.99, "inStock": false }
]</code></pre>


  <p>And copy this data to your <b>users.json</b> file in your <b>/data</b> subfolder.</p>

<pre><button class="copy-code" id="btn-3">Copy <i class="fa-regular fa-copy"></i></button><code id="strCode-3" class="hljs language-json">[
  { "firstName": "Luis", "lastName": "Martinez", "age": 32, "isActive": true },
  { "firstName": "Emma", "lastName": "Smith", "age": 28, "isActive": false },
  { "firstName": "Tom", "lastName": "Murphy", "age": 21, "isActive": true },
  { "firstName": "Sophia", "lastName": "Brown", "age": 45, "isActive": true },
  { "firstName": "James", "lastName": "Wilson", "age": 35, "isActive": false },
  { "firstName": "Olivia", "lastName": "Miller", "age": 29, "isActive": true },
  { "firstName": "Daniel", "lastName": "Taylor", "age": 52, "isActive": true },
  { "firstName": "Ava", "lastName": "Anderson", "age": 24, "isActive": false },
  { "firstName": "Lucas", "lastName": "Thomas", "age": 39, "isActive": true },
  { "firstName": "Mia", "lastName": "Jackson", "age": 31, "isActive": true }
]</code></pre>

</section>

  <section id="basic-example">
          <h2>A very basic Fetch API example</h2>
          <p>Below is a very basic example of the Fetch API in action without error handling. Copy this to your <b>list-products.js</b> file:</p>

<pre><button class="copy-code" id="btn-4">Copy Code <i class="fa-brands fa-square-js"></i></button><code id="strCode-4" class="hljs language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchProductData</span>(<span class="hljs-params"></span>) {
    <span class="hljs-comment">// Fetch the resource and get a Response (status, headers, body stream)</span>
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"data/products.json"</span>);
    <span class="hljs-comment">// Parse the response object to JSON</span>
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
    <span class="hljs-comment">// Verify the code is working by logging the data to the console</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);
}

<span class="hljs-comment">// Call the function to run the fetch request</span>
<span class="hljs-title function_">fetchProductData</span>();</code></pre>

        <p>Copy this same code to your <b>list-users.js</b> file. And then:</p>
        <ol>
          <li>Update the function name to <b>fetchUserData()</b>.</li>
          <li>Update the JSON file name to <b>data/users.json</b>.</li>
        </ol>

</section>

  <section id="cors-file-protocol">

  <h2>CORS and the <code>file://</code> protocol</h2>
  <p>Cross-origin resource sharing (CORS) is a browser mechanism which controls access to resources located outside of a given domain. When you open pages with the <b>file://</b> protocol, the browser treats this as a special (and restricted) origin. Many fetch requests will be blocked—often with CORS-like messages—so you should use a local server.</p>
  
  <img src="assets/img/fetch-json/protocols.png" alt="screenshot" style="max-width:600px" >
  <p>For your <b>list-products.html</b> and <b>list-users.html</b> pages and their scripts to work correctly, you must run them through a local web server, such as the <a href="https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer" target="_blank">VS Code Live Server</a> extension.</p>

  <p>Ensure that you have the Live Server extension installed and running, and that your two HTML files are in your currently-selected folder.</p>

  <img src="assets/img/fetch-json/vscode-live-server-explorer-menu-demo-1.gif" alt="screenshot" class="wider-115"/>

  <img src="assets/img/fetch-json/vscode-live-server-editor-menu-3.jpg" alt="screenshot" style="max-width: 600px"/>


  <p>Finally, open the Console for your two HTML files to see the fetched data.</p>

  <img src="assets/img/fetch-json/console-output.png" alt="screenshot" style="max-width: 740px">

</section>

<section id="fetch-async-api">

    <h2>About the Fetch API</h2>

    <p>You've got your two basic examples working. Now let's look at what's actually happening under the hood.</p>

    <p>The Fetch API is a built-in JavaScript function that enables you to send HTTP requests to web servers and handle the responses.</p>

    <p>You need to supply only a single argument to the <span class="syn-js">fetch()</span> method, known as an <i>endpoint</i>. See below.</p>

<pre><code class="hljs language-js language-javascript">const response = await fetch("ENDPOINT_GOES_HERE");</code></pre>


    <h3 id="promise-response-objects">Working with the <code>Promise</code> and <code>Response</code> objects</h3>
    <p>The Fetch API uses two built-in JavaScript objects. The <span class="syn-js">async</span> keyword makes your function return a Promise to its caller. In this case, the Promise will resolves to a Response.</p>
      
    <p>Think of a Promise as a placeholder for a value that doesn't exist yet. It says: <i>"I am working on retrieving your data. It will be ready shortly."</i></p>

<pre><code class="hljs language-javascript">async function getSomeData() {
    /* A Promise is immediately returned to the calling code.
    To the main thread, this function is now 'finished.'
    In fact, it is running asynchronously outside the main thread */
}</code></pre>    

      <p>This Promise object can have one of three possible statuses:</p>

  <table class="table-js-methods">
    <tbody>
      <tr>
        <td style="min-width: 26%">
          <p>&nbsp;<b>pending</b></p>
        </td>
        <td><p>The request's initial state.</p></td>
      </tr>
      <tr>
        <td style="min-width: 26%">
          <p>&nbsp;<b>fulfilled</b></p>
        </td>
        <td>
          <p>
            The request has completed successfully and a value is
            returned.
          </p>
        </td>
      </tr>
      <tr>
        <td style="min-width: 26%">
          <p>&nbsp;<b>rejected</b></p>
        </td>
        <td>
          <p>
            The request has failed and a reason (error) is returned.
          </p>
        </td>
      </tr>
    </tbody>
  </table>

    <p>A Promise that is either fulfilled or rejected is said to be <i>settled</i>.</p>

  <p>The <span class="syn-js">await</span> keyword tells the <span class="syn-js">async</span> function to pause until a response is received. It says: <i>"Stop executing on this line. Don't move to the next line until a response comes back."</i></p>

<pre><code class="hljs language-javascript">async function getSomeData() {
    const response = await fetch("path/to/file.json");
    // Don't move beyond the above line until a response is received.
}</code></pre>    
        

  <p>Note that <span class="syn-js">await</span> only pauses execution inside the function - <i>not the whole program.</i> The result is that the function behaves asynchronously and the main thread is never blocked.</p>
  
  <p>To the user, the web page remains responsive and does not 'freeze' while waiting for the data to be retrieved.</p>

  <p>Here is a summary of the full process:</p>

  <ol>
    <li>The main program calls a Fetch API function such as <b>getSomeData().</b></li>
    <li>The <span class="syn-js">async</span> keyword tells the function to immediately return a Promise object that says to the calling code: <i>"You carry on. Don't wait for me to finish."</i>
      <span class="inside-ol">&nbsp;</span>
      Because the Fetch API function is now running asynchronously, the main thread of your code is not blocked.</li>
  <li>Inside Fetch API function, the <span class="syn-js">await</span> keyword says: <i>"Stop at this line until a response is received from the endpoint."</i></li>
  <li>Assuming the request succeeds, the status of the Promise object shifts from <i>pending</i> to <i>fulfilled</i>.
    <span class="inside-ol">&nbsp;</span>
    This is when the network response is 'loaded into' the Promise object, resolving it into a Response object.</li>
    <li>The <span class="syn-js">await</span> keyword now allows the Fetch API function to continue executing and process (<i>parse</i>) the response.</li>
</ol>

    

        <h3 id="inside-response">What's inside the <code>response</code> object?</h3>
        <p>The Response object contains more than just the data you are interested in. You can think of it as a 'package' that wraps the full HTTP response, including:</p>

          <table class="table-js-methods">
    <tbody>
      <tr>
        <td style="min-width: 26%">
          <p>&nbsp;<b>Status code</b></p>
        </td>
        <td><p>A numeric code telling you whether the request succeeded or not. <b>200</b> means OK, <b>404</b> means not found, <b>500</b> means a server error, and so on.</p></td>
      </tr>
      <tr>
        <td style="min-width: 26%">
          <p>&nbsp;<b>Headers</b></p>
        </td>
        <td>
          <p>Metadata about the response, such as what format the content is in (<b>Content-Type</b>), how long it is, caching instructions, and more. 
          </p>
        </td>
      </tr>
      <tr>
        <td style="min-width: 26%">
          <p>&nbsp;<b>Security-related info</b></p>
        </td>
        <td>
          <p>
            This includes a <b>type</b> property that tells you something about where the response came from and what security rules applied to it. For example, a value of <b>cors</b> means the server explicitly allowed a cross-origin request, while <b>opaque</b> means the browser restricts what you can read from the response
          </p>
        </td>
      </tr>
      <tr>
        <td style="min-width: 26%">
          <p>&nbsp;<b>Body</b></p>
        </td>
        <td>
          <p>
            This is the actual data you requested, but it arrives as a stream rather than in ready-to-use format. The method you choose to <i>parse</i> this data stream depends on what kind of data you're expecting.
          </p>
        </td>
      </tr>
    </tbody>
  </table>

  <p>In your <b>list-products.js</b> script, add the following code after the line containing the <span class="syn-js">await</span> keyword.</p>

<pre><button class="copy-code" id="btn-5">Copy Code <i class="fa-brands fa-square-js"></i></button><code id="strCode-5" class="hljs language-javascript">
console.log(`Type: ${response.type}`); // e.g. "basic", "cors", "opaque", "opaqueredirect"
console.log(`Status: ${response.status}`); // e.g. 200
console.log(`OK: ${response.ok}`); // true or false
console.log(`URL: ${response.url}`); // the final URL (may differ if redirected)
console.log(`Content-Type: ${response.headers.get('Content-Type')}`);</code></pre>

      <p>In your browser Console you should see the details similar to the following:</p>

      <img src="assets/img/fetch-json/console-response-http.png" alt="screenshot" style="max-width: 740px">


      <h3 id="response-variable">About the <code>response</code> variable</h3>
      <p>Like other JavaScript variables, the <b>response</b> variable can hold a reference to an object, a pointer to where the actual object and its properties and methods live in memory.</p>
      
      <p>In this case, it references the Response object returned by the Fetch API. And it lets you read properties like <span class="syn-js">response.ok</span> and call methods like <span class="syn-js">response.json()</span> to parse the content.</p>

      <pre><code class="hljs language-javascript">/* After Promise object is resolved to a Response object, 
convert the body of the Response object from JSON format 
to a usable JavaScript array. */
    const data = await response.json();</code></pre> 

    <h3 id="parse-response">Parsing the response with <code>.json()</code></h3>
    <p>To work with the data you requested, you need to <i>parse</i> the body of the Response object. The method you choose depends on what kind of data you're expecting to receive.</p>

    <table class="table-js-methods">
  <tbody>
    <tr>
      <td style="min-width: 17%">
         <p> <span class="syn-js">.json()</span></p>
      </td>
      <td>
        <p>
          Use this to parse the response body from JSON format into usable JavaScript code, either an array or an object.
        </p>
      </td>
    </tr>
    <tr>
      <td style="min-width: 17%">
         <p> <span class="syn-js">.text()</span></p>
      </td>
      <td>
        <p>
          Use this to return the response body as a plain string, whatever the content.
        </p>
      </td>
    </tr>
  </tbody>
</table>

<p>Note that the <span class="syn-js">.json()</span> method itself returns a Promise, so the function needs to <span class="syn-js">await</span> for it to finish before continuing. The reason is that the response body arrives as a <i>stream</i>, meaning the data can trickle in over the network in chunks rather than all at once.</p>

<p>Because the body is a stream, it hasn't all arrived yet. <span class="syn-js">.json()</span> reads this stream, waits for all the chunks to arrive, assembles them, and then parses the result. Since this reading and assembling process takes time, <span class="syn-js">.json()</span> itself must return a Promise, which is why we must <span class="syn-js">await</span> it.</p>
  

      <p>When the parsing from JSON-format to a JavaScript array is complete, the <b>data</b> variable will reference a JavaScript array that you can access properties of with dot notation, loop over, and so on.</p>

  <p>So your Fetch API function is actually waiting on <i>two</i> separate asynchronous operations:</p>
  
  <ul>
    <li>The first <span class="syn-js">await</span> gets you the envelope or wrapper.</li>
    <li>The second <span class="syn-js">await</span> opens it and reads the contents.</li>
  </ul>

</section>

         <section id="data-output">
          
          <h2>Outputting data to the web page</h2>
        <p>Now that you have successfully fetched and parsed the JSON data, let's display it on the web page. We will use the <span class="syn-js">.forEach()</span> method to loop through the array and dynamically generate HTML for each item.</p>

        <p>Let's begin by adding an empty <span class="syn">&lt;div&gt;</span> element with an ID of <b>products-container</b> to the <b>list-products.html</b> web page file. This is where JavaScript will insert the generated content.</p>

<pre><button class="copy-code" id="btn-9">Copy Code <i class="fa-brands fa-square-js"></i></button><code id="strCode-9" class="hljs language-html">&lt;div id="products-container"&gt;&lt;/div&gt;</code></pre>

  <p>Now, in your <b>list-products.js</b> script, add the following function call after the second <span class="syn-js">await</span> line in your Fetch API function:</p>
<pre><button class="copy-code" id="btn-10">Copy Code <i class="fa-brands fa-square-js"></i></button><code id="strCode-10" class="hljs language-js">displayProducts(data);</code></pre>

<p>This function call passes the <b>data </b>array as an argument to the new display function, <b>displayProducts()</b>.</p>

<p>Next, add this display function at the bottom of your <b>list-products.js</b> file:</p>

<pre><button class="copy-code" id="btn-11">Copy Code <i class="fa-brands fa-square-js"></i></button><code id="strCode-11" class="hljs language-js">// Function to handle the DOM output
function displayProducts(productsArray) {
    const container = document.getElementById("products-container");
    let htmlOutput = "";

    // Loop through each product in the array
    productsArray.forEach(product =&gt; {
        /* Build the HTML string using the compound assignment operator 
        and template literals.
        Line breaks added for readability */
        htmlOutput += `
            &lt;p&gt;
            &lt;b&gt;${product.name}&lt;/b&gt;
            Price: $${product.price}  
            Available?: ${product.inStock ? "Yes" : "No"}
            &lt;/p&gt;
        `;
    });

    /* Output the final HTML to the "products-container"
    DIV element on the web page */
    container.innerHTML = htmlOutput;
}</code></pre>

  <p>Your web browser should now display the list of products dynamically generated from the JSON data.</p>

  <img src="assets/img/fetch-json/list-products-output.png" alt="screenshot" style="max-width: 700px">

  <p>Repeat the above steps for your <b>list-users.html</b> and <b>list-users.js</b> files.</p>

</section>


<section id="error-checking">
  
  <h2>Error-checking Fetch API requests</h2>
  <p>Because a Fetch API request may be unsuccessful, it is important to add error-checking to your code.</p>
  
  <p>Two types of errors are possible:</p>

  <ul>
        <li><b>HTTP errors</b>: When you successfully connect with the server - but the response received is an error status code, such as <b>404</b> (Not Found) or <b>500</b> (Internal Server Error).</li>
    <li><b>Network errors</b>: When the request cannot be completed, such as when the server cannot be reached or the data is corrupted and cannot be parsed.</li>

  </ul>

  <p>Let's examine how to handle numeric error status codes in your code.</p>

  <h3 id="http-status-errors">Checking for HTTP status errors</h3>
  <p>Every successful server response will include a status code. Any code in the range <b>200-299</b> indicates a successful response.</p>
  
  <p>You can use the <b>.ok</b> property of the Response object to test for such a response.</p>

<pre><button class="copy-code" id="btn-12">Copy Code <i class="fa-brands fa-square-js"></i></button><code id="strCode-12" class="hljs language-js">
// Make a fetch request to the server. Update the endpoint as needed.
const response = await fetch("path/to/file.json");

// *** Test status code is in success range ***
if (!response.ok) { 
    // Any non-successful status code
    console.log(`Network response was not ok - Status: ${response.status}`);
    // Stop executing the function and return control to the calling code
    return; 
} 
/* No else block is necessary 
Handles 200, 201, 204, and any other 2xx success code
Continue to parsing and outputting the server response 
*/
const data = await response.json();  // parse the body
console.log(data);  // inspect it
displayProducts(data);  // use it</code></pre>

<p>Because the 'bad' branch comes first, there is no need for an <span class="syn-js">else</span> block. The <i>early</i> <span class="syn-js">return;</span> statement will cause the Fetch API function to exit if an error occurs.</p>

  <p>Update your <b>list-products.js</b> and <b>list-users.js</b> scripts with the error-checking steps shown above.</p>

    <h3 id="try-catch-errors">Checking for errors with <code>try...catch (error)</code></h3>
  <p>The <span class="syn-js">if(!response.ok)</span> condition handles situations where the server responded properly - <i>even if the response was an error code</i>. For example, 404 (Not Found) or 500 (Internal Server Error) responses are considered a 'success' from the network perspective.</p>

  <p>Wrapping all the code inside your function with a <span class="syn-js">try-catch (error)</span> clause provides wider protection against other types of errors.</p>

  <p>The <span class="syn-js">try-catch</span> statement allows you to test a block of code for errors and handle any exceptions that occur. The basic syntax is as follows.</p>

<pre><code class="hljs language-javascript">try {
    // Code that might cause an error
} catch (error) {
    // Code to handle the error
}</code></pre>
    
<p>Here is how it works:</p>
<ul>
    <li>The <span class="syn-js">try</span> block contains the code that might throw an error.</li>
    <li>If an error occurs, execution of that block stops immediately.</li>
    <li>Control transfers to the <span class="syn-js">catch</span> block.</li>
    <li>The catch parameter (commonly named <span class="syn-js">error</span> or <span class="syn-js">err</span>) contains information about the error.</li>
    <li>After the <span class="syn-js">catch (error)</span> block executes, the program continues running after the <span class="syn-js">try...catch</span> statement.</li>
</ul>

  <p>For error-checking Fetch API requests, you wrap the <i>entire</i> fetch code inside a <span class="syn-js">try</span> block, and then add a <span class="syn-js">catch</span> block to handle any errors that occur.</p>
<pre><code class="hljs language-javascript">async function getSomeData() {
    try {
        // code to fetch and process server data goes here
    } 
    catch (error) {
        // Handle any errors that occur in the try block
        console.error(`Error fetching data: ${error}`);
    } // end of try-catch

} // end of Fetch API function</code></pre>

  <p>In summary:</p>

<table class="table-js-methods">
  <tbody>
    <tr>
      <td style="min-width: 30%">
        <p><span class="syn-js"> if (!response.ok) {}</span></p>
      </td>
      <td><p>Detects HTTP errors. A "404 Not Found" or a "500 Server Error" is treated as a successful network connection.</p></td>
    </tr>
    <tr>
      <td style="min-width: 30%">
        <p><span class="syn-js">try...catch (error)</span></p>
      </td>
      <td>
        <p>Handles network and code failures, such as Internet connection or DNS failures, or if the <span class="syn-js">response.json()</span> method crashes because the file is corrupted.
        </p>
      </td>
    </tr>
  </tbody>
</table>



  <p>Update your <b>list-products.js</b> and <b>list-users.js</b> scripts as shown above.</p>

        </section>


	<section class="resources-learning" id="try-it">

        <h2>Try it yourself</h2>

        <p>On one of your sample script files, change the endpoint to the name of a file that does not exist - for example, <b>data/wrong-file.json</b>. In your browser console, note how your <span class="syn-js">if (!response.ok) { }</span> block catches the 404 error and logs the status.</p>

        <p>------</p>

        <p>Create a text file named <b>books.json</b> and use an AI to populate it with 10 books with the following keys:</p>
<p>- title<br>
- author<br>
- year<br>
- isRead</p>

<p>Create a web page named <b>books.html</b> and inside it an HTML <span class="syn">div</span> tag with an <b>id</b> of <b>books-output</b>.</p>

<p>In the web page file, write JavaScript to fetch and display the book data.</p>
<p>Include the two levels of error-checking.</p>

   
      </section>
    


       <section class="resources-learning" id="resources">

              <h2>More learning resources</h2>
          
              <div class="flex-container">
                <div class="text-container">
                  <h3><span><i class="fa-solid fa-circle-question"></i> Tutorial Quiz</span></h3>
                  <p><a href="https://brendan-munnelly.github.io/quiz-dorset-javascript/#/quiz-questions/17" target="_blank"><i class="fa-solid fa-circle-arrow-right"></i> &nbsp;&nbsp;Take the test</a></p>
          
                </div>
            
                <div class="audio-container">
                  <h3><span><i class="fa-solid fa-microphone"></i> Tutorial Podcast</span></h3>
          
                  <audio controls>
                    <source src="assets/audio/fetch-api-json.mp3" type="audio/mp3">
                    Your browser does not support the audio element.
                  </audio>
          
                </div>
              </div>
          
            </section>
            
            <section class="resources-learning" id="ai-prompts">
          
              <h2>Sample AI prompts</h2>
          
            
              <div class="gpt"><button class="copy-gpt" id="btn-15">Copy <i class="fa-regular fa-lightbulb"></i></button><code id="strCode-15">Explain the JavaScript fetch API and the concepts of async and await using a real-world analogy, like ordering food at a restaurant.</code></div>
           
			  
			  <div class="gpt"><button class="copy-gpt" id="btn-16">Copy <i class="fa-regular fa-lightbulb"></i></button><code id="strCode-16">
			  What is a CORS error in JavaScript? Explain it simply and tell me the most common ways developers fix or bypass it during local development.</code></div>


            </section>


      </article>
    </main>

    <footer></footer>
    <div id="cookie-banner">
      <p>This website uses cookies to ensure you get the best user experience. <a href="https://munnelly.com/privacy.html">Learn more</a>.</p>
      <div class="buttons">
          <button id="accept-cookies">Got it</button>
      </div>
  </div>

<script>hljs.highlightAll();</script>

<script src="assets/js/utils.js"></script>


</body>
</html>

